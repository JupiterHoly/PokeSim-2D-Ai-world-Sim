<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Unofficial Poke Sim</title>
  <style>
    :root {
      --bg-dark: #050913;
      --bg-panel: #0b1626;
      --bg-panel-light: #101d33;
      --accent: #33ffd7;
      --accent-soft: rgba(51, 255, 215, 0.25);
      --text-main: #f4f8ff;
      --text-muted: #7aa1c4;
      --danger: #ff4f6d;
      --success: #66ff9f;
      --shadow: 0 20px 45px rgba(0, 0, 0, 0.45);
    }

    * {
      box-sizing: border-box;
    }

    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      font-family: "Press Start 2P", "VT323", "Trebuchet MS", sans-serif;
      background: radial-gradient(circle at top, #0f1c33 0%, #03060f 60%);
      color: var(--text-main);
      overflow: hidden;
    }

    body {
      position: relative;
    }

    #loading-screen {
      position: fixed;
      inset: 0;
      background: radial-gradient(circle at 30% 30%, rgba(51, 255, 215, 0.1), transparent 45%),
        radial-gradient(circle at 70% 20%, rgba(255, 111, 207, 0.15), transparent 50%),
        linear-gradient(145deg, #04070f, #08101f 40%, #03050a);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 2.5rem;
      z-index: 1000;
      overflow: hidden;
    }

    #loading-screen::before,
    #loading-screen::after {
      content: "";
      position: absolute;
      width: 120%;
      height: 120%;
      background: radial-gradient(circle, rgba(51, 255, 215, 0.08), transparent 55%);
      animation: shimmer 18s linear infinite;
      z-index: 0;
    }

    #loading-screen::after {
      background: radial-gradient(circle, rgba(255, 95, 162, 0.09), transparent 60%);
      animation-direction: reverse;
    }

    @keyframes shimmer {
      0% {
        transform: rotate(0deg) translateY(-10%);
      }
      50% {
        transform: rotate(180deg) translateY(10%);
      }
      100% {
        transform: rotate(360deg) translateY(-10%);
      }
    }

    .pokeball {
      position: relative;
      width: 120px;
      height: 120px;
      border-radius: 50%;
      background: linear-gradient(#f4304b 48%, #07090f 52%);
      box-shadow: inset 0 6px 12px rgba(255, 255, 255, 0.3), inset 0 -8px 14px rgba(0, 0, 0, 0.5), var(--shadow);
      animation: float 3s ease-in-out infinite;
      z-index: 1;
    }

    .pokeball::before {
      content: "";
      position: absolute;
      inset: 15px 15px 60px 15px;
      border-radius: 60px 60px 20px 20px;
      background: radial-gradient(circle at 50% 25%, rgba(255, 255, 255, 0.9), transparent 60%);
      opacity: 0.75;
    }

    .pokeball::after {
      content: "";
      position: absolute;
      top: 50%;
      left: 50%;
      width: 34px;
      height: 34px;
      transform: translate(-50%, -50%);
      border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, #ffffff, #a8d5ff 65%, #203040 80%);
      box-shadow: 0 0 0 6px #f4f8ff, 0 0 0 12px #0b1524;
    }

    @keyframes float {
      0%, 100% {
        transform: translateY(-6px) rotate(-4deg);
      }
      50% {
        transform: translateY(6px) rotate(4deg);
      }
    }

    .sparkle {
      position: absolute;
      width: 6px;
      height: 6px;
      background: radial-gradient(circle, rgba(255, 255, 255, 0.9), rgba(51, 255, 215, 0.8));
      border-radius: 50%;
      animation: twinkle 2.6s ease-in-out infinite;
      z-index: 1;
    }

    .sparkle:nth-child(2) { top: 20%; left: 32%; animation-delay: 0.3s; }
    .sparkle:nth-child(3) { top: 68%; left: 66%; animation-delay: 1.2s; }
    .sparkle:nth-child(4) { top: 42%; left: 74%; animation-delay: 1.8s; }
    .sparkle:nth-child(5) { top: 78%; left: 20%; animation-delay: 2.1s; }

    @keyframes twinkle {
      0%, 100% { transform: scale(0.6); opacity: 0.2; }
      50% { transform: scale(1.4); opacity: 1; }
    }

    .loader-title {
      font-size: 1.2rem;
      letter-spacing: 0.2rem;
      text-align: center;
      z-index: 1;
      text-shadow: 0 0 12px rgba(51, 255, 215, 0.75);
    }

    .progress-container {
      width: min(320px, 80vw);
      background: rgba(15, 30, 60, 0.4);
      border-radius: 12px;
      padding: 8px;
      box-shadow: inset 0 0 0 1px rgba(51, 255, 215, 0.45), 0 15px 35px rgba(0, 0, 0, 0.4);
      z-index: 1;
    }

    .progress-bar {
      width: 0%;
      height: 16px;
      border-radius: 8px;
      background: linear-gradient(90deg, rgba(51, 255, 215, 0.5), rgba(51, 255, 215, 0.95));
      box-shadow: 0 0 12px rgba(51, 255, 215, 0.6);
      transition: width 0.25s ease;
    }

    #game-container {
      display: none;
      height: 100vh;
      width: 100vw;
      flex-direction: column;
      position: relative;
    }

    #game-container.active {
      display: flex;
    }

    .top-bar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.8rem 1.4rem;
      background: rgba(6, 14, 25, 0.92);
      border-bottom: 1px solid rgba(51, 255, 215, 0.18);
      box-shadow: 0 10px 24px rgba(0, 0, 0, 0.45);
      z-index: 10;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      font-size: 1rem;
      letter-spacing: 0.12rem;
    }

    .brand span {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: linear-gradient(145deg, rgba(51, 255, 215, 0.35), rgba(51, 255, 215, 0.1));
      box-shadow: inset 0 0 8px rgba(51, 255, 215, 0.4), 0 0 12px rgba(51, 255, 215, 0.4);
    }

    .top-info {
      display: flex;
      gap: 1.5rem;
      align-items: center;
      font-size: 0.82rem;
      color: var(--text-muted);
    }

    .top-info span {
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
    }

    .layout {
      flex: 1;
      display: grid;
      grid-template-columns: 320px 1fr;
      min-height: 0;
      position: relative;
    }

    .sidebar {
      position: relative;
      display: flex;
      flex-direction: column;
      background: linear-gradient(180deg, rgba(5, 13, 24, 0.96), rgba(9, 18, 32, 0.92));
      border-right: 1px solid rgba(51, 255, 215, 0.15);
      box-shadow: inset -1px 0 0 rgba(51, 255, 215, 0.08);
      overflow: hidden;
    }

    .tabs {
      position: sticky;
      top: 0;
      display: grid;
      grid-template-columns: repeat(7, minmax(0, 1fr));
      background: rgba(7, 15, 27, 0.96);
      border-bottom: 1px solid rgba(51, 255, 215, 0.1);
      z-index: 5;
    }

    .tabs button {
      padding: 0.85rem 0.2rem;
      border: none;
      background: transparent;
      color: var(--text-muted);
      font-size: 0.68rem;
      text-transform: uppercase;
      letter-spacing: 0.08rem;
      cursor: pointer;
      transition: color 0.2s ease, background 0.2s ease;
    }

    .tabs button.active {
      color: var(--accent);
      background: rgba(51, 255, 215, 0.08);
      box-shadow: inset 0 -3px 0 var(--accent);
    }

    .tab-content {
      flex: 1;
      overflow-y: auto;
      padding: 1.2rem 1.2rem 2.5rem;
      display: none;
      scrollbar-width: thin;
      scrollbar-color: rgba(51, 255, 215, 0.3) rgba(8, 16, 28, 0.5);
    }

    .tab-content.active {
      display: block;
    }

    .stat-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
      gap: 0.85rem;
    }

    .stat-card {
      padding: 0.9rem;
      border-radius: 12px;
      background: linear-gradient(160deg, rgba(16, 30, 54, 0.92), rgba(7, 12, 22, 0.92));
      border: 1px solid rgba(51, 255, 215, 0.12);
      box-shadow: inset 0 0 18px rgba(51, 255, 215, 0.04);
    }

    .stat-card .label {
      font-size: 0.65rem;
      color: var(--text-muted);
      letter-spacing: 0.1rem;
    }

    .stat-card .value {
      font-size: 1.35rem;
      margin-top: 0.35rem;
      color: var(--accent);
    }

    .trainer-card, .pokemon-card {
      padding: 1rem;
      border-radius: 12px;
      background: linear-gradient(160deg, rgba(12, 22, 38, 0.95), rgba(7, 12, 20, 0.9));
      border: 1px solid rgba(51, 255, 215, 0.1);
      margin-bottom: 0.75rem;
      display: flex;
      align-items: flex-start;
      gap: 0.85rem;
      box-shadow: inset 0 0 12px rgba(51, 255, 215, 0.05);
    }

    .trainer-card .avatar, .pokemon-card .avatar {
      width: 42px;
      height: 42px;
      border-radius: 10px;
      background: rgba(51, 255, 215, 0.08);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
    }

    .trainer-card .meta, .pokemon-card .meta {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 0.35rem;
      font-size: 0.72rem;
    }

    .pokemon-card {
      flex-direction: column;
    }

    #pokemon-list {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 0.9rem;
    }

    .type-badge {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 0.25rem 0.55rem;
      border-radius: 999px;
      font-size: 0.6rem;
      letter-spacing: 0.08rem;
      background: rgba(51, 255, 215, 0.1);
      border: 1px solid rgba(51, 255, 215, 0.2);
    }

    .map-container {
      position: relative;
      background: linear-gradient(180deg, rgba(7, 15, 26, 0.94), rgba(5, 10, 18, 0.94));
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    .map-toolbar {
      position: absolute;
      top: 1rem;
      left: 1rem;
      display: flex;
      gap: 0.6rem;
      z-index: 5;
    }

    .map-toolbar button {
      padding: 0.5rem 0.75rem;
      border-radius: 8px;
      border: 1px solid rgba(51, 255, 215, 0.25);
      background: rgba(10, 22, 32, 0.65);
      color: var(--text-main);
      font-size: 0.75rem;
      cursor: pointer;
      transition: background 0.2s ease, transform 0.2s ease;
    }

    .map-toolbar button:hover {
      background: rgba(51, 255, 215, 0.2);
      transform: translateY(-1px);
    }

    #world-canvas, #neural-canvas {
      flex: 1;
      width: 100%;
      height: 100%;
      display: block;
      background: rgba(5, 11, 19, 0.9);
    }

    .minimap {
      position: absolute;
      top: 1rem;
      right: 1rem;
      width: 200px;
      height: 200px;
      border-radius: 14px;
      background: rgba(5, 14, 24, 0.9);
      border: 1px solid rgba(51, 255, 215, 0.15);
      box-shadow: 0 12px 24px rgba(0, 0, 0, 0.35);
      padding: 0.75rem;
      z-index: 4;
    }

    #minimap-canvas {
      width: 100%;
      height: 100%;
      border-radius: 10px;
      background: rgba(8, 16, 28, 0.85);
      display: block;
    }

    .list-container {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    #prayers-list, #events-list {
      max-height: calc(100vh - 250px);
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
      padding-right: 0.25rem;
    }

    .prayer-item, .event-item {
      padding: 0.7rem 0.85rem;
      border-radius: 10px;
      background: rgba(13, 26, 40, 0.92);
      border: 1px solid rgba(51, 255, 215, 0.12);
      font-size: 0.72rem;
      line-height: 1.3;
    }

    .event-item strong {
      color: var(--accent);
    }

    .tab-header {
      margin-bottom: 1.1rem;
      font-size: 0.75rem;
      letter-spacing: 0.08rem;
      color: var(--text-muted);
      text-transform: uppercase;
    }

    .toggle-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.85rem 1rem;
      border-radius: 12px;
      background: linear-gradient(160deg, rgba(14, 26, 40, 0.9), rgba(7, 13, 22, 0.88));
      border: 1px solid rgba(51, 255, 215, 0.12);
      margin-bottom: 0.75rem;
    }

    .toggle-row button {
      position: relative;
      width: 52px;
      height: 26px;
      border-radius: 999px;
      background: rgba(51, 255, 215, 0.1);
      border: 1px solid rgba(51, 255, 215, 0.25);
      cursor: pointer;
      transition: background 0.25s ease;
    }

    .toggle-row button::after {
      content: "";
      position: absolute;
      top: 3px;
      left: 3px;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.85);
      transition: transform 0.25s ease;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.25);
    }

    .toggle-row button.active {
      background: rgba(51, 255, 215, 0.5);
      box-shadow: 0 0 12px rgba(51, 255, 215, 0.45);
    }

    .toggle-row button.active::after {
      transform: translateX(24px);
      background: #0a1826;
    }

    .tab-actions {
      margin-top: 1.2rem;
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    .action-button {
      padding: 0.85rem 1rem;
      border-radius: 10px;
      border: 1px solid rgba(51, 255, 215, 0.25);
      background: rgba(12, 25, 40, 0.9);
      color: var(--text-main);
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.08rem;
      cursor: pointer;
      transition: transform 0.2s ease, background 0.2s ease;
    }

    .action-button:hover {
      background: rgba(51, 255, 215, 0.25);
      transform: translateY(-1px);
    }

    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(4, 9, 18, 0.8);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 50;
      padding: 2rem 1rem;
    }

    .modal-overlay.active {
      display: flex;
    }

    .modal {
      width: min(420px, 90vw);
      background: linear-gradient(160deg, rgba(9, 18, 30, 0.96), rgba(4, 8, 15, 0.96));
      border-radius: 16px;
      padding: 1.5rem;
      border: 1px solid rgba(51, 255, 215, 0.2);
      box-shadow: var(--shadow);
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .modal h2 {
      margin: 0;
      font-size: 1rem;
      letter-spacing: 0.12rem;
      text-transform: uppercase;
    }

    .modal form {
      display: flex;
      flex-direction: column;
      gap: 0.85rem;
    }

    .modal label {
      font-size: 0.7rem;
      letter-spacing: 0.08rem;
      text-transform: uppercase;
      color: var(--text-muted);
    }

    .modal input,
    .modal select,
    .modal textarea {
      width: 100%;
      padding: 0.65rem;
      border-radius: 8px;
      border: 1px solid rgba(51, 255, 215, 0.2);
      background: rgba(9, 18, 30, 0.85);
      color: var(--text-main);
      font-size: 0.78rem;
    }

    .modal input[type="range"] {
      height: 4px;
      padding: 0;
      background: transparent;
    }

    .modal .modal-actions {
      display: flex;
      gap: 0.75rem;
      margin-top: 0.25rem;
    }

    .modal button {
      padding: 0.75rem 1rem;
      border-radius: 8px;
      border: 1px solid rgba(51, 255, 215, 0.3);
      background: rgba(8, 16, 28, 0.92);
      color: var(--text-main);
      text-transform: uppercase;
      letter-spacing: 0.08rem;
      cursor: pointer;
      transition: background 0.2s ease, transform 0.2s ease;
    }

    .modal button.primary {
      background: rgba(51, 255, 215, 0.3);
    }

    .modal button:hover {
      transform: translateY(-1px);
      background: rgba(51, 255, 215, 0.25);
    }

    .close-button {
      align-self: flex-end;
      background: rgba(255, 79, 109, 0.18) !important;
      border-color: rgba(255, 79, 109, 0.5) !important;
    }

    #neural-info {
      margin-top: 1rem;
      padding: 0.85rem 1rem;
      border-radius: 12px;
      background: rgba(12, 25, 40, 0.92);
      border: 1px solid rgba(51, 255, 215, 0.15);
      font-size: 0.72rem;
      line-height: 1.4;
    }

    #toast-container {
      position: fixed;
      bottom: 1.5rem;
      right: 1.5rem;
      display: flex;
      flex-direction: column;
      gap: 0.65rem;
      z-index: 80;
    }

    .toast {
      background: rgba(7, 15, 28, 0.92);
      border: 1px solid rgba(51, 255, 215, 0.35);
      border-radius: 10px;
      padding: 0.75rem 1rem;
      font-size: 0.72rem;
      box-shadow: 0 12px 30px rgba(0, 0, 0, 0.4);
      opacity: 0;
      transform: translateY(10px);
      animation: toast-in 0.35s forwards;
    }

    @keyframes toast-in {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes toast-out {
      to {
        opacity: 0;
        transform: translateY(10px);
      }
    }

    .sidebar-toggle {
      display: none;
      margin-right: 1rem;
      padding: 0.5rem 0.75rem;
      border-radius: 8px;
      border: 1px solid rgba(51, 255, 215, 0.2);
      background: rgba(8, 16, 28, 0.7);
      color: var(--text-main);
      cursor: pointer;
    }

    @media (max-width: 1100px) {
      .layout {
        grid-template-columns: minmax(0, 1fr);
      }
      .sidebar {
        position: absolute;
        inset: 0;
        transform: translateX(-100%);
        transition: transform 0.3s ease;
        z-index: 20;
      }
      .sidebar.open {
        transform: translateX(0);
      }
      .map-container {
        min-height: 0;
      }
      .sidebar-toggle {
        display: inline-flex;
      }
    }

    a { color: inherit; }
  </style>
</head>
<body>
  <div id="loading-screen">
    <div class="sparkle"></div>
    <div class="sparkle"></div>
    <div class="sparkle"></div>
    <div class="sparkle"></div>
    <div class="sparkle"></div>
    <div class="pokeball"></div>
    <div class="loader-title">⚡ UNOFFICIAL POKE SIM</div>
    <div class="progress-container">
      <div id="progress-bar" class="progress-bar"></div>
    </div>
  </div>

  <div id="game-container">
    <audio id="bg-music" loop>
      <source src="https://cdn.jsdelivr.net/gh/thatcatfromspace/pokered-music@main/audio/012%20-%20Pallet%20Town%20Theme.mp3" type="audio/mpeg">
    </audio>

    <div class="top-bar">
      <div class="brand"><button class="sidebar-toggle" onclick="toggleSidebar()">☰</button><span>⚡</span>UNOFFICIAL POKE SIM</div>
      <div class="top-info">
        <span id="time-text">00:00</span>
        <span><span id="weather-icon">☀️</span><span id="weather-text">Sunny</span></span>
        <span id="tick-text">Tick: 0</span>
      </div>
    </div>

    <div class="layout">
      <aside class="sidebar" id="sidebar">
        <div class="tabs">
          <button data-tab="world" class="active" onclick="switchTab('world')">World</button>
          <button data-tab="trainers" onclick="switchTab('trainers')">Trainers</button>
          <button data-tab="pokemon" onclick="switchTab('pokemon')">Pokemon</button>
          <button data-tab="neural" onclick="switchTab('neural')">Neural</button>
          <button data-tab="prayers" onclick="switchTab('prayers')">Prayers</button>
          <button data-tab="events" onclick="switchTab('events')">Events</button>
          <button data-tab="settings" onclick="switchTab('settings')">Settings</button>
        </div>
        <div class="tab-content active" id="tab-world">
          <div class="tab-header">World Stats</div>
          <div class="stat-grid">
            <div class="stat-card"><div class="label">Trainers</div><div id="stat-trainers" class="value">0</div></div>
            <div class="stat-card"><div class="label">Pokemon</div><div id="stat-pokemon" class="value">0</div></div>
            <div class="stat-card"><div class="label">Battles</div><div id="stat-battles" class="value">0</div></div>
            <div class="stat-card"><div class="label">Encounters</div><div id="stat-encounters" class="value">0</div></div>
            <div class="stat-card"><div class="label">Towns</div><div id="stat-towns" class="value">0</div></div>
            <div class="stat-card"><div class="label">Routes</div><div id="stat-routes" class="value">0</div></div>
          </div>
          <div class="tab-actions">
            <button class="action-button" onclick="document.getElementById('god-modal').classList.add('active')">Enter God Mode</button>
            <button class="action-button" onclick="changeWeather()">Change Weather</button>
            <button class="action-button" onclick="timeSkip()">Skip Time +1h</button>
          </div>
        </div>
        <div class="tab-content" id="tab-trainers">
          <div class="tab-header">Active Trainers</div>
          <div id="trainers-list" class="list-container"></div>
        </div>
        <div class="tab-content" id="tab-pokemon">
          <div class="tab-header">Pokemon Index</div>
          <div id="pokemon-list"></div>
        </div>
        <div class="tab-content" id="tab-neural">
          <div class="tab-header">Neural Net Visualizer</div>
          <canvas id="neural-canvas" width="320" height="220"></canvas>
          <div id="neural-info">Dynamic neural pathways visualize trainer decision weights. Connections flicker as simulated minds evaluate travel, battle, rest, and prayer responses.</div>
        </div>
        <div class="tab-content" id="tab-prayers">
          <div class="tab-header">Whispers &amp; Prayers</div>
          <div id="prayers-list"></div>
        </div>
        <div class="tab-content" id="tab-events">
          <div class="tab-header">World Events</div>
          <div id="events-list"></div>
        </div>
        <div class="tab-content" id="tab-settings">
          <div class="tab-header">Simulation Settings</div>
          <div class="toggle-row"><span>Background Music</span><button id="toggle-music" class="active" onclick="toggleSetting('music')"></button></div>
          <div class="toggle-row"><span>Minimap</span><button id="toggle-minimap" class="active" onclick="toggleSetting('minimap')"></button></div>
          <div class="toggle-row"><span>Auto Prayers</span><button id="toggle-prayers" class="active" onclick="toggleSetting('prayers')"></button></div>
          <div class="toggle-row"><span>Trainer Paths</span><button id="toggle-paths" class="active" onclick="toggleSetting('paths')"></button></div>
          <div class="toggle-row"><span>Retro Sprites</span><button id="toggle-sprites" class="active" onclick="toggleSetting('sprites')"></button></div>
          <div class="toggle-row"><span>Realistic Time</span><button id="toggle-time" class="active" onclick="toggleSetting('time')"></button></div>
        </div>
      </aside>

      <section class="map-container">
        <div class="map-toolbar">
          <button onclick="zoomIn()">Zoom +</button>
          <button onclick="zoomOut()">Zoom -</button>
          <button onclick="centerCamera()">Center</button>
        </div>
        <canvas id="world-canvas"></canvas>
        <div class="minimap" id="minimap-card">
          <canvas id="minimap-canvas" width="200" height="200"></canvas>
        </div>
      </section>
    </div>
  </div>

  <div id="god-modal" class="modal-overlay">
    <div class="modal">
      <h2>God Mode</h2>
      <p style="font-size:0.75rem;color:var(--text-muted);line-height:1.4;">Bend the simulation at will. Spawn beings, alter the skies, or bathe the world in miracles.</p>
      <div class="modal-actions">
        <button onclick="openCreateTrainer()">Create Trainer</button>
        <button onclick="openCreateNPC()">Create NPC</button>
        <button onclick="createRandomNPC()">Random NPC</button>
        <button onclick="healAll()">Heal All</button>
      </div>
      <div class="modal-actions">
        <button onclick="spawnPokemon()">Spawn Pokemon</button>
        <button onclick="changeWeather()">Change Weather</button>
        <button onclick="timeSkip()">Skip Time</button>
        <button onclick="triggerEvent()">Trigger Event</button>
      </div>
      <button class="close-button" onclick="closeModal('god-modal')">Close</button>
    </div>
  </div>

  <div id="trainer-modal" class="modal-overlay">
    <div class="modal">
      <h2>Create Trainer</h2>
      <form id="trainer-form" onsubmit="createTrainer(event)">
        <label for="trainer-name">Name</label>
        <input id="trainer-name" required placeholder="Mira" />
        <label for="trainer-personality">Personality</label>
        <select id="trainer-personality">
          <option>Calm</option>
          <option>Aggressive</option>
          <option>Curious</option>
          <option>Strategist</option>
          <option>Dreamer</option>
        </select>
        <label for="trainer-role">Role</label>
        <select id="trainer-role">
          <option>Explorer</option>
          <option>Gym Leader</option>
          <option>Breeder</option>
          <option>Researcher</option>
          <option>Rival</option>
        </select>
        <label for="trainer-starter">Starter Pokemon</label>
        <select id="trainer-starter">
          <option>Bulbasaur</option>
          <option>Charmander</option>
          <option>Squirtle</option>
          <option>Pikachu</option>
          <option>Eevee</option>
        </select>
        <label for="trainer-control">Control Type</label>
        <select id="trainer-control">
          <option>AI</option>
          <option>Hybrid</option>
          <option>Observer</option>
        </select>
        <label for="trainer-intelligence">Intelligence <span id="intel-value">60</span></label>
        <input id="trainer-intelligence" type="range" min="10" max="100" value="60" oninput="document.getElementById('intel-value').textContent = this.value" />
        <div class="modal-actions">
          <button type="submit" class="primary">Create</button>
          <button type="button" onclick="closeModal('trainer-modal')">Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <div id="npc-modal" class="modal-overlay">
    <div class="modal">
      <h2>Create NPC</h2>
      <form id="npc-form" onsubmit="createNPC(event)">
        <label for="npc-name">Name</label>
        <input id="npc-name" required placeholder="Old Man Fuji" />
        <label for="npc-type">Type</label>
        <select id="npc-type">
          <option>Merchant</option>
          <option>Healer</option>
          <option>Guide</option>
          <option>Scientist</option>
          <option>Storyteller</option>
        </select>
        <label for="npc-behavior">Behavior</label>
        <select id="npc-behavior">
          <option>Wanders</option>
          <option>Stationary</option>
          <option>Quest Giver</option>
          <option>Trainer Mentor</option>
        </select>
        <div class="modal-actions">
          <button type="submit" class="primary">Create</button>
          <button type="button" onclick="closeModal('npc-modal')">Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <div id="toast-container"></div>
  <script>
    const GAME_CONFIG = {
      MINUTES_PER_TICK: 10,
      TICK_INTERVAL: 2000,
      PRAYER_CHANCE: 0.25,
      EVENT_CHANCE: 0.35,
      MAX_EVENTS: 80,
      MAX_PRAYERS: 80,
      WORLD_SIZE: 1800
    };

    const state = {
      tick: 0,
      minutes: 8 * 60,
      weather: { icon: '☀️', name: 'Sunny' },
      stats: {
        trainers: 0,
        pokemon: 0,
        battles: 0,
        encounters: 0,
        towns: 5,
        routes: 9
      },
      trainers: [],
      npcs: [],
      pokemon: [],
      prayers: [],
      events: [],
      toggles: {
        music: true,
        minimap: true,
        prayers: true,
        paths: true,
        sprites: true,
        time: true
      }
    };

    const weatherTypes = [
      { icon: '☀️', name: 'Sunny' },
      { icon: '⛅', name: 'Partly Cloudy' },
      { icon: '🌧️', name: 'Rainy' },
      { icon: '⛈️', name: 'Stormy' },
      { icon: '🌫️', name: 'Foggy' },
      { icon: '❄️', name: 'Snowy' }
    ];

    const trainerNames = ['Mira', 'Ash', 'Bianca', 'Cedric', 'Diantha', 'Ethan', 'Fenn', 'Gloria', 'Hiro', 'Iris'];
    const trainerPersonas = ['Calm', 'Aggressive', 'Curious', 'Strategist', 'Dreamer'];
    const trainerRoles = ['Explorer', 'Gym Leader', 'Breeder', 'Researcher', 'Rival'];
    const trainerStarters = ['Bulbasaur', 'Charmander', 'Squirtle', 'Pikachu', 'Eevee'];

    const pokemonDex = [
      { name: 'Bulbasaur', type: 'Grass/Poison', emoji: '🌿', level: 12 },
      { name: 'Charmander', type: 'Fire', emoji: '🔥', level: 11 },
      { name: 'Squirtle', type: 'Water', emoji: '💧', level: 11 },
      { name: 'Pikachu', type: 'Electric', emoji: '⚡', level: 14 },
      { name: 'Eevee', type: 'Normal', emoji: '🦊', level: 13 },
      { name: 'Jigglypuff', type: 'Fairy', emoji: '🎵', level: 10 },
      { name: 'Geodude', type: 'Rock/Ground', emoji: '🪨', level: 15 },
      { name: 'Gastly', type: 'Ghost/Poison', emoji: '👻', level: 16 },
      { name: 'Magikarp', type: 'Water', emoji: '🐟', level: 7 },
      { name: 'Onix', type: 'Rock/Ground', emoji: '🪨', level: 18 },
      { name: 'Abra', type: 'Psychic', emoji: '🔮', level: 17 },
      { name: 'Lapras', type: 'Water/Ice', emoji: '🐚', level: 22 },
      { name: 'Snorlax', type: 'Normal', emoji: '😴', level: 24 },
      { name: 'Dragonite', type: 'Dragon/Flying', emoji: '🐉', level: 28 }
    ];

    const prayerPhrases = [
      'May my Pikachu find a friendly rival today.',
      'Let the rains cleanse Route 3.',
      'Grant me a sign before I challenge the gym.',
      'Please guide lost travelers through the fog.',
      'Bless the berries in Viridian Forest.',
      'Send a worthy opponent to test my team.',
      'Keep my Eevee safe through the night.',
      'Let the winds carry tales of my victories.'
    ];

    const eventPhrases = [
      'A sudden flock of Pidgey shifted the skies.',
      'Trainers spotted rare footprints near the river.',
      'A healing festival brightened Lavender Town.',
      'An electrical storm charged the power plant.',
      'Mysterious lights danced across the midnight dunes.',
      'A migrating herd of Tauros thundered through Route 5.',
      'Archaeologists uncovered ancient Pokéball relics.'
    ];

    let worldCtx, minimapCtx, neuralCtx;
    const camera = { x: GAME_CONFIG.WORLD_SIZE / 2, y: GAME_CONFIG.WORLD_SIZE / 2, zoom: 0.5 };
    let isDragging = false;
    let dragStart = { x: 0, y: 0 };
    const terrainBlobs = Array.from({ length: 14 }).map((_, i) => ({
      x: (i * 123) % GAME_CONFIG.WORLD_SIZE,
      y: ((i * 213) + 400) % GAME_CONFIG.WORLD_SIZE,
      radius: 160 + (i * 37) % 140,
      tilt: (i * 28) * Math.PI / 180,
      color: `rgba(${30 + (i * 20) % 120}, ${80 + (i * 12) % 120}, ${120 + (i * 7) % 120}, 0.4)`
    }));
    const townLocations = Array.from({ length: 8 }).map((_, i) => ({
      x: 200 + i * 180,
      y: (i * 260 + 120) % GAME_CONFIG.WORLD_SIZE
    }));
    const routeLines = Array.from({ length: 16 }).map((_, i) => ({
      x1: 120 + (i * 90),
      y1: 80,
      x2: (i * 150) % GAME_CONFIG.WORLD_SIZE,
      y2: GAME_CONFIG.WORLD_SIZE - 120
    }));

    function startGame() {
      const progressBar = document.getElementById('progress-bar');
      let progress = 0;
      const interval = setInterval(() => {
        progress = Math.min(100, progress + Math.random() * 22);
        progressBar.style.width = progress + '%';
        if (progress >= 100) {
          clearInterval(interval);
          setTimeout(() => {
            document.getElementById('loading-screen').style.display = 'none';
            const container = document.getElementById('game-container');
            container.classList.add('active');
            initWorld();
          }, 350);
        }
      }, 180);
    }

    function initWorld() {
      initCanvas();
      initNeural();
      seedWorld();
      renderPokemon();
      updateStats();
      updateTimeDisplay();
      updateWeatherDisplay();
      addEvent('Simulation boot sequence complete.');
      document.getElementById('bg-music').volume = 0.4;
      setupMusicAutoplay();
      setInterval(tickWorld, GAME_CONFIG.TICK_INTERVAL);
    }

    function setupMusicAutoplay() {
      const music = document.getElementById('bg-music');
      const playMusic = () => {
        music.play().catch(() => {});
        window.removeEventListener('pointerdown', playMusic);
        window.removeEventListener('keydown', playMusic);
      };
      window.addEventListener('pointerdown', playMusic);
      window.addEventListener('keydown', playMusic);
    }

    function seedWorld() {
      state.trainers = Array.from({ length: 6 }).map(() => createTrainerData());
      renderTrainers();
      state.pokemon = pokemonDex;
      state.stats.towns = 6;
      state.stats.routes = 12;
    }

    function createTrainerData(overrides = {}) {
      const name = overrides.name || trainerNames[Math.floor(Math.random() * trainerNames.length)] + ' #' + Math.floor(Math.random() * 90 + 10);
      return {
        name,
        personality: overrides.personality || trainerPersonas[Math.floor(Math.random() * trainerPersonas.length)],
        role: overrides.role || trainerRoles[Math.floor(Math.random() * trainerRoles.length)],
        starter: overrides.starter || trainerStarters[Math.floor(Math.random() * trainerStarters.length)],
        control: overrides.control || ['AI', 'Hybrid', 'Observer'][Math.floor(Math.random() * 3)],
        intelligence: overrides.intelligence || Math.floor(Math.random() * 40) + 60,
        mood: ['Focused', 'Restless', 'Inspired', 'Tired'][Math.floor(Math.random() * 4)]
      };
    }

    function renderTrainers() {
      const list = document.getElementById('trainers-list');
      list.innerHTML = '';
      state.trainers.forEach(trainer => {
        const card = document.createElement('div');
        card.className = 'trainer-card';
        card.innerHTML = `
          <div class="avatar">🎒</div>
          <div class="meta">
            <strong>${trainer.name}</strong>
            <span>Personality: ${trainer.personality}</span>
            <span>Role: ${trainer.role}</span>
            <span>Starter: ${trainer.starter}</span>
            <span>AI: ${trainer.control} • IQ ${trainer.intelligence}</span>
            <span>Status: ${trainer.mood}</span>
          </div>
        `;
        list.appendChild(card);
      });
      updateStats();
    }

    function renderPokemon() {
      const grid = document.getElementById('pokemon-list');
      grid.innerHTML = '';
      state.pokemon.forEach(p => {
        const card = document.createElement('div');
        card.className = 'pokemon-card';
        card.innerHTML = `
          <div class="avatar">${p.emoji}</div>
          <div class="meta">
            <strong>${p.name}</strong>
            <span>Type: <span class="type-badge">${p.type}</span></span>
            <span>Level ${p.level}</span>
          </div>
        `;
        grid.appendChild(card);
      });
      state.stats.pokemon = state.pokemon.length;
      updateStats();
    }

    function updateStats() {
      state.stats.trainers = state.trainers.length;
      document.getElementById('stat-trainers').textContent = state.stats.trainers;
      document.getElementById('stat-pokemon').textContent = state.stats.pokemon;
      document.getElementById('stat-battles').textContent = state.stats.battles;
      document.getElementById('stat-encounters').textContent = state.stats.encounters;
      document.getElementById('stat-towns').textContent = state.stats.towns;
      document.getElementById('stat-routes').textContent = state.stats.routes;
    }

    function tickWorld() {
      state.tick += 1;
      state.minutes += GAME_CONFIG.MINUTES_PER_TICK;
      if (state.minutes >= 24 * 60) state.minutes -= 24 * 60;
      if (Math.random() < 0.3) state.stats.battles += Math.floor(Math.random() * 3);
      if (Math.random() < 0.35) state.stats.encounters += Math.floor(Math.random() * 2);
      updateStats();
      updateTimeDisplay();
      if (state.tick % 6 === 0 || Math.random() < 0.15) {
        state.weather = weatherTypes[Math.floor(Math.random() * weatherTypes.length)];
        updateWeatherDisplay();
        addEvent('Weather shifted to ' + state.weather.name + '.');
      }
      if (state.toggles.prayers && Math.random() < GAME_CONFIG.PRAYER_CHANCE) {
        const message = prayerPhrases[Math.floor(Math.random() * prayerPhrases.length)];
        addPrayer(message);
      }
      if (Math.random() < GAME_CONFIG.EVENT_CHANCE) {
        addEvent(eventPhrases[Math.floor(Math.random() * eventPhrases.length)]);
      }
      document.getElementById('tick-text').textContent = 'Tick: ' + state.tick;
    }

    function updateTimeDisplay() {
      const hours = Math.floor(state.minutes / 60);
      const mins = state.minutes % 60;
      const display = `${hours.toString().padStart(2, '0')}:${mins.toString().padStart(2, '0')}`;
      document.getElementById('time-text').textContent = display;
    }

    function updateWeatherDisplay() {
      document.getElementById('weather-icon').textContent = state.weather.icon;
      document.getElementById('weather-text').textContent = state.weather.name;
    }

    function addPrayer(message) {
      const list = document.getElementById('prayers-list');
      const item = document.createElement('div');
      item.className = 'prayer-item';
      const timeStamp = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
      item.innerHTML = `<strong>${timeStamp}</strong> — ${message}`;
      list.prepend(item);
      state.prayers.unshift(message);
      if (list.children.length > GAME_CONFIG.MAX_PRAYERS) list.removeChild(list.lastChild);
    }

    function addEvent(message) {
      const list = document.getElementById('events-list');
      const item = document.createElement('div');
      item.className = 'event-item';
      const timeStamp = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
      item.innerHTML = `<strong>${timeStamp}</strong> — ${message}`;
      list.prepend(item);
      state.events.unshift(message);
      if (list.children.length > GAME_CONFIG.MAX_EVENTS) list.removeChild(list.lastChild);
    }

    function toggleSidebar() {
      const sidebar = document.getElementById('sidebar');
      sidebar.classList.toggle('open');
    }

    function switchTab(name) {
      document.querySelectorAll('.tabs button').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.tab === name);
      });
      document.querySelectorAll('.tab-content').forEach(panel => {
        panel.classList.toggle('active', panel.id === 'tab-' + name);
      });
      if (window.innerWidth <= 1100) {
        document.getElementById('sidebar').classList.remove('open');
      }
    }

    function toggleSetting(key) {
      state.toggles[key] = !state.toggles[key];
      const button = document.getElementById('toggle-' + key);
      button.classList.toggle('active', state.toggles[key]);
      if (key === 'music') {
        const music = document.getElementById('bg-music');
        if (state.toggles.music) {
          music.volume = 0.4;
          music.play().catch(() => {});
        } else {
          music.pause();
        }
      }
      if (key === 'minimap') {
        document.getElementById('minimap-card').style.display = state.toggles.minimap ? 'block' : 'none';
      }
      if (key === 'time') {
        GAME_CONFIG.MINUTES_PER_TICK = state.toggles.time ? 10 : 30;
        showToast('Time flow adjusted.');
      }
      if (key === 'sprites') {
        document.body.classList.toggle('retro-sprites', state.toggles.sprites);
        showToast('Retro sprites ' + (state.toggles.sprites ? 'enabled' : 'disabled') + '.');
      }
    }

    function openCreateTrainer() {
      document.getElementById('trainer-modal').classList.add('active');
    }

    function openCreateNPC() {
      document.getElementById('npc-modal').classList.add('active');
    }

    function closeModal(id) {
      document.getElementById(id).classList.remove('active');
    }

    function createTrainer(event) {
      event.preventDefault();
      const data = {
        name: document.getElementById('trainer-name').value,
        personality: document.getElementById('trainer-personality').value,
        role: document.getElementById('trainer-role').value,
        starter: document.getElementById('trainer-starter').value,
        control: document.getElementById('trainer-control').value,
        intelligence: document.getElementById('trainer-intelligence').value
      };
      state.trainers.unshift(createTrainerData(data));
      renderTrainers();
      addEvent(data.name + ' joined the world.');
      showToast('Trainer created successfully.');
      event.target.reset();
      document.getElementById('trainer-intelligence').value = 60;
      document.getElementById('intel-value').textContent = '60';
      closeModal('trainer-modal');
    }

    function createNPC(event) {
      event.preventDefault();
      const npc = {
        name: document.getElementById('npc-name').value,
        type: document.getElementById('npc-type').value,
        behavior: document.getElementById('npc-behavior').value
      };
      state.npcs.unshift(npc);
      addEvent(`${npc.name} the ${npc.type.toLowerCase()} arrived (${npc.behavior}).`);
      showToast('NPC created.');
      event.target.reset();
      closeModal('npc-modal');
    }

    function createRandomNPC() {
      const npc = {
        name: 'NPC ' + Math.floor(Math.random() * 900 + 100),
        type: ['Merchant', 'Healer', 'Guide', 'Scientist'][Math.floor(Math.random() * 4)],
        behavior: ['Wanders', 'Stationary', 'Quest Giver'][Math.floor(Math.random() * 3)]
      };
      state.npcs.unshift(npc);
      addEvent(`${npc.name} drifted into town as a ${npc.type.toLowerCase()}.`);
      showToast('Random NPC spawned.');
    }

    function healAll() {
      addEvent('A wave of light restored every party to full health.');
      showToast('All Pokémon healed.');
    }

    function spawnPokemon() {
      const species = pokemonDex[Math.floor(Math.random() * pokemonDex.length)];
      const newcomer = { ...species, level: species.level + Math.floor(Math.random() * 4) };
      state.pokemon.unshift(newcomer);
      renderPokemon();
      addEvent(`${newcomer.name} appeared nearby at level ${newcomer.level}.`);
      showToast(`${newcomer.name} spawned.`);
    }

    function changeWeather() {
      state.weather = weatherTypes[Math.floor(Math.random() * weatherTypes.length)];
      updateWeatherDisplay();
      addEvent('Weather command issued: ' + state.weather.name + '.');
      showToast('Weather shifted to ' + state.weather.name + '.');
    }

    function timeSkip() {
      state.minutes += 60;
      if (state.minutes >= 24 * 60) state.minutes -= 24 * 60;
      updateTimeDisplay();
      addEvent('Time skipped ahead by one hour.');
      showToast('Hour skipped.');
    }

    function triggerEvent() {
      const phrase = eventPhrases[Math.floor(Math.random() * eventPhrases.length)];
      addEvent('Divine event: ' + phrase);
      showToast('Miracle unleashed.');
    }

    function showToast(message) {
      const container = document.getElementById('toast-container');
      const toast = document.createElement('div');
      toast.className = 'toast';
      toast.textContent = message;
      container.appendChild(toast);
      setTimeout(() => {
        toast.style.animation = 'toast-out 0.35s forwards';
        toast.addEventListener('animationend', () => {
          toast.remove();
        });
      }, 2500);
    }

    function initCanvas() {
      const worldCanvas = document.getElementById('world-canvas');
      worldCtx = worldCanvas.getContext('2d');
      minimapCtx = document.getElementById('minimap-canvas').getContext('2d');
      resizeCanvas();
      window.addEventListener('resize', resizeCanvas);
      worldCanvas.addEventListener('pointerdown', startDrag);
      window.addEventListener('pointermove', drag);
      window.addEventListener('pointerup', endDrag);
      window.addEventListener('pointerleave', endDrag);
      requestAnimationFrame(drawWorldLoop);
    }

    function resizeCanvas() {
      const canvas = document.getElementById('world-canvas');
      const rect = canvas.parentElement.getBoundingClientRect();
      canvas.width = rect.width;
      canvas.height = rect.height;
      drawWorld();
      drawMinimap();
    }

    function startDrag(event) {
      isDragging = true;
      dragStart.x = event.clientX;
      dragStart.y = event.clientY;
      document.body.style.cursor = 'grabbing';
    }

    function drag(event) {
      if (!isDragging) return;
      const deltaX = (event.clientX - dragStart.x) / camera.zoom;
      const deltaY = (event.clientY - dragStart.y) / camera.zoom;
      camera.x -= deltaX;
      camera.y -= deltaY;
      camera.x = Math.max(0, Math.min(GAME_CONFIG.WORLD_SIZE, camera.x));
      camera.y = Math.max(0, Math.min(GAME_CONFIG.WORLD_SIZE, camera.y));
      dragStart.x = event.clientX;
      dragStart.y = event.clientY;
      drawWorld();
      drawMinimap();
    }

    function endDrag() {
      isDragging = false;
      document.body.style.cursor = '';
    }

    function zoomIn() {
      camera.zoom = Math.min(2.4, camera.zoom + 0.15);
      drawWorld();
      drawMinimap();
    }

    function zoomOut() {
      camera.zoom = Math.max(0.3, camera.zoom - 0.15);
      drawWorld();
      drawMinimap();
    }

    function centerCamera() {
      camera.x = GAME_CONFIG.WORLD_SIZE / 2;
      camera.y = GAME_CONFIG.WORLD_SIZE / 2;
      camera.zoom = 0.8;
      drawWorld();
      drawMinimap();
    }

    function drawWorldLoop() {
      drawWorld();
      drawMinimap();
      requestAnimationFrame(drawWorldLoop);
    }

    function drawWorld() {
      if (!worldCtx) return;
      const canvas = worldCtx.canvas;
      worldCtx.clearRect(0, 0, canvas.width, canvas.height);
      worldCtx.save();
      worldCtx.translate(canvas.width / 2, canvas.height / 2);
      worldCtx.scale(camera.zoom, camera.zoom);
      worldCtx.translate(-camera.x, -camera.y);

      const gradient = worldCtx.createRadialGradient(GAME_CONFIG.WORLD_SIZE / 2, GAME_CONFIG.WORLD_SIZE / 2, 200, GAME_CONFIG.WORLD_SIZE / 2, GAME_CONFIG.WORLD_SIZE / 2, 900);
      gradient.addColorStop(0, '#13355a');
      gradient.addColorStop(1, '#08111f');
      worldCtx.fillStyle = gradient;
      worldCtx.fillRect(0, 0, GAME_CONFIG.WORLD_SIZE, GAME_CONFIG.WORLD_SIZE);

      terrainBlobs.forEach(blob => {
        worldCtx.fillStyle = blob.color;
        worldCtx.beginPath();
        worldCtx.ellipse(blob.x, blob.y, blob.radius, blob.radius * 0.6, blob.tilt, 0, Math.PI * 2);
        worldCtx.fill();
      });

      townLocations.forEach(town => {
        worldCtx.fillStyle = 'rgba(51, 255, 215, 0.75)';
        worldCtx.fillRect(town.x, town.y, 55, 55);
        worldCtx.strokeStyle = 'rgba(8, 20, 32, 0.9)';
        worldCtx.lineWidth = 4;
        worldCtx.strokeRect(town.x, town.y, 55, 55);
      });

      worldCtx.strokeStyle = 'rgba(255, 255, 255, 0.2)';
      worldCtx.lineWidth = 6;
      worldCtx.lineCap = 'round';
      worldCtx.beginPath();
      routeLines.forEach(route => {
        worldCtx.moveTo(route.x1, route.y1);
        worldCtx.lineTo(route.x2, route.y2);
      });
      worldCtx.stroke();

      worldCtx.restore();
    }

    function drawMinimap() {
      if (!minimapCtx) return;
      const canvas = minimapCtx.canvas;
      minimapCtx.clearRect(0, 0, canvas.width, canvas.height);
      minimapCtx.fillStyle = '#0a1626';
      minimapCtx.fillRect(0, 0, canvas.width, canvas.height);

      minimapCtx.fillStyle = 'rgba(51, 255, 215, 0.3)';
      minimapCtx.fillRect(18, 18, canvas.width - 36, canvas.height - 36);

      minimapCtx.fillStyle = 'rgba(12, 30, 48, 0.8)';
      minimapCtx.fillRect(28, 28, canvas.width - 56, canvas.height - 56);

      minimapCtx.strokeStyle = 'rgba(51, 255, 215, 0.6)';
      minimapCtx.lineWidth = 2;
      const scale = (canvas.width - 56) / GAME_CONFIG.WORLD_SIZE;
      const viewWidth = worldCtx.canvas.width / camera.zoom * scale;
      const viewHeight = worldCtx.canvas.height / camera.zoom * scale;
      const viewX = 28 + (camera.x - viewWidth / (2 * scale)) * scale;
      const viewY = 28 + (camera.y - viewHeight / (2 * scale)) * scale;
      minimapCtx.strokeRect(viewX, viewY, viewWidth, viewHeight);
    }

    const neuralNodes = Array.from({ length: 24 }).map((_, i) => ({
      x: Math.random() * 320,
      y: Math.random() * 220,
      vx: (Math.random() - 0.5) * 0.6,
      vy: (Math.random() - 0.5) * 0.6,
      radius: 3 + Math.random() * 2,
      layer: i % 4
    }));

    function initNeural() {
      neuralCtx = document.getElementById('neural-canvas').getContext('2d');
      requestAnimationFrame(renderNeural);
    }

    function renderNeural() {
      if (!neuralCtx) return;
      const canvas = neuralCtx.canvas;
      neuralCtx.clearRect(0, 0, canvas.width, canvas.height);
      neuralCtx.fillStyle = '#0a1626';
      neuralCtx.fillRect(0, 0, canvas.width, canvas.height);

      neuralCtx.strokeStyle = 'rgba(51, 255, 215, 0.25)';
      neuralCtx.lineWidth = 1;
      for (let i = 0; i < neuralNodes.length; i++) {
        for (let j = i + 1; j < neuralNodes.length; j++) {
          const a = neuralNodes[i];
          const b = neuralNodes[j];
          const dist = Math.hypot(a.x - b.x, a.y - b.y);
          if (dist < 120) {
            neuralCtx.globalAlpha = 1 - dist / 140;
            neuralCtx.beginPath();
            neuralCtx.moveTo(a.x, a.y);
            neuralCtx.lineTo(b.x, b.y);
            neuralCtx.stroke();
          }
        }
      }
      neuralCtx.globalAlpha = 1;
      neuralNodes.forEach(node => {
        node.x += node.vx;
        node.y += node.vy;
        if (node.x < 10 || node.x > canvas.width - 10) node.vx *= -1;
        if (node.y < 10 || node.y > canvas.height - 10) node.vy *= -1;
        const gradient = neuralCtx.createRadialGradient(node.x, node.y, 1, node.x, node.y, node.radius * 2);
        gradient.addColorStop(0, '#33ffd7');
        gradient.addColorStop(1, 'rgba(51, 255, 215, 0)');
        neuralCtx.fillStyle = gradient;
        neuralCtx.beginPath();
        neuralCtx.arc(node.x, node.y, node.radius * 2, 0, Math.PI * 2);
        neuralCtx.fill();
      });
      requestAnimationFrame(renderNeural);
    }

    window.addEventListener('keydown', event => {
      if (event.key === 'Escape') {
        ['god-modal', 'trainer-modal', 'npc-modal'].forEach(closeModal);
      }
    });

    document.getElementById('god-modal').addEventListener('click', event => {
      if (event.target === event.currentTarget) closeModal('god-modal');
    });
    document.getElementById('trainer-modal').addEventListener('click', event => {
      if (event.target === event.currentTarget) closeModal('trainer-modal');
    });
    document.getElementById('npc-modal').addEventListener('click', event => {
      if (event.target === event.currentTarget) closeModal('npc-modal');
    });

    window.zoomIn = zoomIn;
    window.zoomOut = zoomOut;
    window.centerCamera = centerCamera;
    window.toggleSidebar = toggleSidebar;
    window.switchTab = switchTab;
    window.toggleSetting = toggleSetting;
    window.openCreateTrainer = openCreateTrainer;
    window.openCreateNPC = openCreateNPC;
    window.closeModal = closeModal;
    window.createRandomNPC = createRandomNPC;
    window.healAll = healAll;
    window.spawnPokemon = spawnPokemon;
    window.changeWeather = changeWeather;
    window.timeSkip = timeSkip;
    window.triggerEvent = triggerEvent;
    window.createTrainer = createTrainer;
    window.createNPC = createNPC;

    document.addEventListener('DOMContentLoaded', startGame);
  </script>
</body>
</html>
